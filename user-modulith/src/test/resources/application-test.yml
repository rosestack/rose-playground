# 测试环境配置 - 使用 Testcontainers MySQL
spring:
  application:
    name: user-modulith-test
  profiles:
    active: test
  
  # 数据源配置 - 将由 Testcontainers 动态配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # URL 将由 @Testcontainers 动态设置
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 300000
      max-lifetime: 900000
  
  # SQL 初始化配置
  sql:
    init:
      mode: always
      schema-locations: classpath:schema.sql
      data-locations: classpath:data-test.sql
      continue-on-error: false

# 日志配置
logging:
  level:
    io.github.rosestack: DEBUG
    com.baomidou.mybatisplus.core.mapper: DEBUG
    org.testcontainers: INFO
    com.github.dockerjava: WARN
    org.springframework.test: DEBUG

# Rose MyBatis 配置
rose:
  mybatis:
    enabled: true
    encryption:
      enabled: true
      key-rotation:
        enabled: true
        auto-rotation-days: 90
        key-retention-days: 30
        auto-cleanup: true
    data-permission:
      enabled: true
      cache:
        enabled: true
        management-enabled: true
    audit:
      enabled: true
      log-level: INFO
    tenant:
      enabled: false

# 管理端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,data-permission-cache,key-rotation
  endpoint:
    health:
      show-details: always
