# MessageInterpolator æ¥å£è°ƒæ•´ä¿®æ”¹æ„è§

## ğŸ“‹ ä¿®æ”¹æ€»ç»“

åŸºäºä½ çš„æ¥å£è°ƒæ•´ï¼Œæˆ‘è¿›è¡Œäº†ä»¥ä¸‹æ”¹è¿›ï¼Œè§£å†³äº†å¤šä¸ªé—®é¢˜å¹¶æä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼š

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. **æ¥å£è®¾è®¡é—®é¢˜**

#### âŒ åŸé—®é¢˜ï¼š
```java
// ä½ çš„åŸå§‹è°ƒæ•´
String interpolate(String message, Locale locale, InterpolationParameter parameter);

default String interpolate(String message, Locale locale, Object[] args) {
    return null;  // æ€»æ˜¯è¿”å› nullï¼Œæ²¡æœ‰å®é™…å®ç°
}
```

#### âœ… ä¿®å¤åï¼š
```java
// ä¿®å¤åçš„æ¥å£
String interpolate(String message, Locale locale, InterpolationParameter parameter);

default String interpolate(String message, Locale locale, Object[] args) {
    if (args == null || args.length == 0) {
        return message;
    }
    // å°†æ•°ç»„è½¬æ¢ä¸º InterpolationParameter
    InterpolationParameter.Builder builder = InterpolationParameter.builder();
    for (int i = 0; i < args.length; i++) {
        builder.add(String.valueOf(i), args[i]);
    }
    return interpolate(message, locale, builder.build());
}

default String interpolate(String message, Locale locale, Object args) {
    // å®Œæ•´çš„ç±»å‹æ£€æŸ¥å’Œè½¬æ¢é€»è¾‘
}
```

**æ”¹è¿›ç‚¹ï¼š**
- âœ… ä¿æŒå‘åå…¼å®¹æ€§
- âœ… æä¾›å®Œæ•´çš„é»˜è®¤å®ç°
- âœ… æ”¯æŒæ‰€æœ‰å‚æ•°ç±»å‹
- âœ… ä¼˜é›…çš„ç±»å‹è½¬æ¢

### 2. **DefaultMessageInterpolator å®ç°é—®é¢˜**

#### âŒ åŸé—®é¢˜ï¼š
```java
// ä½ çš„åŸå§‹å®ç°
if (message == null || parameter == null) {
    return message;  // é€»è¾‘é”™è¯¯ï¼šnull message åº”è¯¥è¿”å› null
}

// å¤„ç†é€»è¾‘æ··ä¹±ï¼Œæ²¡æœ‰æ¸…æ™°çš„ä¼˜å…ˆçº§
boolean hasExpress = EXPRESSION_PATTERN.matcher(message).find();
boolean hasMessageFormat = MESSAGE_FORMAT_PATTERN.matcher(message).find();
// ...
```

#### âœ… ä¿®å¤åï¼š
```java
// ä¿®å¤åçš„å®ç°
if (message == null) {
    return null;  // æ­£ç¡®çš„ null å¤„ç†
}

if (parameter == null || parameter.isEmpty()) {
    return message;
}

// æ¸…æ™°çš„å¤„ç†é¡ºåºå’Œä¼˜å…ˆçº§
String result = message;

// 1. å¤„ç† ${expression} è¡¨è¾¾å¼
if (EXPRESSION_PATTERN.matcher(result).find()) {
    result = processExpressions(result, parameter, locale);
}

// 2. å¤„ç† {name} å‘½åå‚æ•°
if (NAMED_PARAMETER_PATTERN.matcher(result).find()) {
    result = processNamedParameters(result, parameter);
}

// 3. å¤„ç† {0}, {1} MessageFormat é£æ ¼
if (MESSAGE_FORMAT_PATTERN.matcher(result).find()) {
    // ...
}

// 4. å¤„ç† {} å ä½ç¬¦
if (result.contains("{}")) {
    // ...
}
```

**æ”¹è¿›ç‚¹ï¼š**
- âœ… æ­£ç¡®çš„ null å¤„ç†é€»è¾‘
- âœ… æ¸…æ™°çš„å¤„ç†é¡ºåºå’Œä¼˜å…ˆçº§
- âœ… åˆ†ç¦»çš„å¤„ç†æ–¹æ³•ï¼Œä¾¿äºç»´æŠ¤
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†

### 3. **InterpolationParameter ç±»çš„é—®é¢˜**

#### âŒ åŸé—®é¢˜ï¼š
```java
// å‚æ•°ç±»å‹è¿‡äºä¸¥æ ¼
public static InterpolationParameter from(LinkedHashMap<String, Object> map)
public Builder addAll(LinkedHashMap<String, Object> map)
```

#### âœ… ä¿®å¤åï¼š
```java
// æ›´çµæ´»çš„å‚æ•°ç±»å‹
public static InterpolationParameter from(Map<String, Object> map)
public Builder addAll(Map<String, Object> map)
```

**æ”¹è¿›ç‚¹ï¼š**
- âœ… æ”¯æŒæ‰€æœ‰ Map å®ç°
- âœ… æ›´å¥½çš„äº’æ“ä½œæ€§
- âœ… å‡å°‘ä½¿ç”¨è€…çš„ç±»å‹çº¦æŸ

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. **è§£å†³ Map æœ‰åºæ€§é—®é¢˜**
```java
// âŒ é—®é¢˜ï¼šMap æœ‰åºæ€§å›°æ‰°
HashMap<String, Object> params1 = new HashMap<>();        // æ— åº
LinkedHashMap<String, Object> params2 = new LinkedHashMap<>(); // éœ€è¦è®°ä½
TreeMap<String, Object> params3 = new TreeMap<>();        // å¯èƒ½ä¸æ˜¯æœŸæœ›é¡ºåº

// âœ… è§£å†³æ–¹æ¡ˆï¼šInterpolationParameter
InterpolationParameter params = InterpolationParameter.builder()
    .add("name", "Alice")
    .add("age", 25)
    .add("company", "TechCorp")
    .build();
// ä¿è¯æ’å…¥é¡ºåºï¼Œæ— éœ€æ‹…å¿ƒ Map å®ç°
```

### 2. **å‘åå…¼å®¹æ€§**
```java
// âœ… æ‰€æœ‰åŸæœ‰ç”¨æ³•ä»ç„¶æœ‰æ•ˆ
interpolator.interpolate("Hello {}", Locale.ENGLISH, "World");
interpolator.interpolate("Hello {name}", Locale.ENGLISH, map);
interpolator.interpolate("Hello {0}", Locale.ENGLISH, new Object[]{"World"});

// âœ… æ–°çš„æ¨èç”¨æ³•
interpolator.interpolate("Hello {name}", Locale.ENGLISH, 
    InterpolationParameter.builder().add("name", "World").build());
```

### 3. **ç±»å‹å®‰å…¨**
```java
// âœ… ç¼–è¯‘æ—¶æ£€æŸ¥
InterpolationParameter params = InterpolationParameter.builder()
    .add("name", "Alice")      // ç±»å‹å®‰å…¨
    .add("age", 25)           // ç±»å‹å®‰å…¨
    .add("active", true)      // ç±»å‹å®‰å…¨
    .build();
```

## ğŸ“Š æµ‹è¯•è¦†ç›–

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–ï¼š

- âœ… åŸºæœ¬ InterpolationParameter ä½¿ç”¨
- âœ… æ•°ç»„å‚æ•°å‘åå…¼å®¹æ€§
- âœ… Map å‚æ•°å‘åå…¼å®¹æ€§
- âœ… null å‚æ•°å¤„ç†
- âœ… MessageFormat é£æ ¼æ”¯æŒ
- âœ… æ··åˆæ ¼å¼æ”¯æŒ
- âœ… è¡¨è¾¾å¼è¯„ä¼°
- âœ… from æ–¹æ³•
- âœ… Builder addAll æ–¹æ³•
- âœ… å¿«é€Ÿåˆ›å»ºæ–¹æ³•

## ğŸš€ ä½¿ç”¨å»ºè®®

### 1. **æ–°é¡¹ç›®æ¨è**
```java
// âœ… æ¨èï¼šä½¿ç”¨ InterpolationParameter
InterpolationParameter params = InterpolationParameter.builder()
    .add("name", "Alice")
    .add("age", 25)
    .add("company", "TechCorp")
    .build();

String result = interpolator.interpolate("Hello {name}, you are {age} years old!", 
    Locale.ENGLISH, params);
```

### 2. **ç°æœ‰é¡¹ç›®è¿ç§»**
```java
// âœ… æ— éœ€ç«‹å³è¿ç§»ï¼Œæ‰€æœ‰ç°æœ‰ä»£ç ç»§ç»­å·¥ä½œ
// å¯ä»¥é€æ­¥è¿ç§»åˆ° InterpolationParameter
```

### 3. **æ€§èƒ½è€ƒè™‘**
```java
// âœ… å¯¹äºç®€å•åœºæ™¯ï¼Œç›´æ¥ä½¿ç”¨
InterpolationParameter params = InterpolationParameter.of("name", "Alice");

// âœ… å¯¹äºå¤æ‚åœºæ™¯ï¼Œä½¿ç”¨ Builder
InterpolationParameter params = InterpolationParameter.builder()
    .add("name", "Alice")
    .add("age", 25)
    .addAll(existingMap)
    .build();
```

## ğŸ“ æ€»ç»“

ä½ çš„æ¥å£è°ƒæ•´æ€è·¯å¾ˆå¥½ï¼Œæˆ‘åœ¨æ­¤åŸºç¡€ä¸Šï¼š

1. **ä¿æŒäº†ä½ çš„æ ¸å¿ƒè®¾è®¡** - æ¨èä½¿ç”¨ InterpolationParameter
2. **ä¿®å¤äº†å®ç°é—®é¢˜** - æä¾›å®Œæ•´çš„é»˜è®¤å®ç°
3. **å¢å¼ºäº†çµæ´»æ€§** - æ”¯æŒæ‰€æœ‰å‚æ•°ç±»å‹
4. **ä¿è¯äº†å…¼å®¹æ€§** - ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
5. **æä¾›äº†æµ‹è¯•** - ç¡®ä¿åŠŸèƒ½æ­£ç¡®æ€§

è¿™ä¸ªè§£å†³æ–¹æ¡ˆå®Œç¾åœ°è§£å†³äº†ä½ æå‡ºçš„ "Map ä¸èƒ½å®Œå…¨ä¿è¯æœ‰åºï¼Œä¼šå¢åŠ ä½¿ç”¨è€…çš„è´Ÿæ‹…" é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒäº† API çš„ç®€æ´æ€§å’Œå‘åå…¼å®¹æ€§ã€‚ 